const fs = require('fs');
const path = require('path');

// خريطة الفصول
const chapterMap = {
  'copyright': 'حقوق_الطبع_والنشر.html',
  'foreword-ammar': 'تقديم_د_عمار_ابو_الصبح.html',
  'foreword-sami': 'تقديم_د_سامي_زايد.html',
  'contents': 'جدول_المحتويات.html',
  '0': 'تنسيق مقدمة كتاب السلامة والجودة في التخدير.html',
  'min-ramad': 'من_رماد_الذاكرة.html',
  '1': 'الفصل_الأول_السلامة_في_التخدير (1).html',
  '2': 'الفصل_الثاني_المفاهيم_والنماذج.html',
  '3': 'الفصل_الثالث_العوامل_البشرية.html',
  '4': 'الفصل_الرابع_العمل_الجماعي.html',
  '5': 'الفصل_الخامس_إدارة_الجودة.html',
  '6': 'الفصل_السادس_التحسين_المستمر.html',
  '7': 'الفصل_السابع_القياس_في_التخدير.html',
  '8': 'الفصل_الثامن_الحوكمة_السريرية.html',
  '9': 'الفصل_التاسع_الابلاغ_عن_الحوادث.html',
  '10': 'الفصل_العاشر_تصميم_الموثوقية.html',
  '11': 'الفصل_الحادي_عشر_ثقافة_السلامة.html',
  '12': 'الفصل_الثاني_عشر_التعليم_والكفاءة.html',
  '13': 'الفصل_الثالث_عشر_تقييم_المخاطر.html',
  '14': 'الفصل_الرابع_عشر_قوائم_التحقق.html',
  '15': 'الفصل_الخامس_عشر_السلامة_قبل_العملية (1).html',
  '16': 'الفصل 16 - السلامة أثناء العملية المراقبة وأمان مجرى الهواء.html',
  '17': 'الفصل 17 - سلامة الأدوية في التخدير.html',
  '18': 'الفصل 18 - سلامة المعدات والمراقبة.html',
  '19': 'الفصل 19 - السلامة أثناء العمليات الوقاية من آليات الضرر الشائعة.html',
  '20': 'الفصل 20 - سلامة التخدير الناحي والاستعداد لـ LAST.html',
  '21': 'الفصل 21 - سلامة التهدئة من الخفيفة إلى العميقة.html',
  '22': 'الفصل 22 - التخدير خارج غرفة العمليات.html',
  '23': 'الفصل 23 - سلامة وحدة الإفاقة والوقاية من مضاعفات ما بعد العملية.html',
  '24': 'الفصل 24 - التميز في التسليم نقل المرضى (1).html',
  '25': 'الفصل 25 - تخدير الولادة أنظمة أمان للأم والطفل.html',
  '26': 'الفصل 26 - سلامة تخدير الأطفال وحديثي الولادة.html',
  '27': 'الفصل 27 - جودة التخدير للمرضى المسنين المعتمدة على الهشاشة (1).html',
  '28': 'الفصل 28 - حالات القلب والأوعية الكبرى ممارسة الموثوقية العالية.html',
  '29': 'الفصل 29 - تخدير الإصابات والطوارئ السلامة الحرجة بالوقت.html',
  '30': 'الفصل 30 - واجهات العناية المركزة والرعاية الحرجة.html',
  '31': 'الفصل 31 - علم التنفيذ لمشاريع السلامة في التخدير.html',
  '32': 'الفصل 32 - استدامة التميز في سلامة وجودة التخدير.html',
  '33': 'الخاتمة.html',
  '34': 'المصادر_والمراجع.html'
};

module.exports = async (req, res) => {
  const { id } = req.query;
  
  if (!id || !chapterMap[id]) {
    return res.status(404).send('Chapter not found');
  }
  
  const filename = chapterMap[id];
  const filePath = path.join(process.cwd(), 'public', 'chapters', filename);
  
  try {
    const content = fs.readFileSync(filePath, 'utf-8');
    res.setHeader('Content-Type', 'text/html; charset=utf-8');
    res.status(200).send(content);
  } catch (error) {
    res.status(500).send('Error reading chapter file');
  }
};
